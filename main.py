import math

from base64 import b64encode, b64decode


def get_services_bits_enc(services_list):
    services = set(services_list)
    bits = int()
    for service_id, index in ALL_SERVICE_INDICES:
        if service_id in services:
            bitmask = 1 << index
            bits |= bitmask

    bytes_len = math.ceil(len(ALL_SERVICE_INDICES) / 8)
    services_bytes = bits.to_bytes(bytes_len, byteorder='big')
    return b64encode(services_bytes)


def get_services_from_bits_enc(services_bits_enc):
    svcs_bytes = b64decode(services_bits_enc)
    bits = int.from_bytes(svcs_bytes, byteorder='big')
    services = []

    for service_id, index in ALL_SERVICE_INDICES:
        bitmask = 1 << index
        if bits & bitmask:
            services.append(service_id)

    return services


"""A 2-tuple of Service ID, bit-mask Index """
ALL_SERVICE_INDICES = [
    (0, 0),
    (1062, 1),
    (1069, 2),
    (1081, 3),
    (1086, 4),
    (1255, 5),
    (1258, 6),
    (1321, 7),
    (1393, 8),
    (1502, 9),
    (1503, 10),
    (2869, 11),
    (3895, 12),
    (3904, 13),
    (3953, 14),
    (3955, 15),
    (3985, 16),
    (3995, 17),
    (3996, 18),
    (4002, 19),
    (4003, 20),
    (4006, 21),
    (4009, 22),
    (4014, 23),
    (4017, 24),
    (4021, 25),
    (4027, 26),
    (4028, 27),
    (4031, 28),
    (4032, 29),
    (4033, 30),
    (4034, 31),
    (4035, 32),
    (4036, 33),
    (4037, 34),
    (4038, 35),
    (4039, 36),
    (4040, 37),
    (4041, 38),
    (4042, 39),
    (4043, 40),
    (4044, 41),
    (4045, 42),
    (4046, 43),
    (4047, 44),
    (4048, 45),
    (4049, 46),
    (4050, 47),
    (4052, 48),
    (4053, 49),
    (4054, 50),
    (4055, 51),
    (4056, 52),
    (4057, 53),
    (4058, 54),
    (4059, 55),
    (4060, 56),
    (4061, 57),
    (4062, 58),
    (4063, 59),
    (4064, 60),
    (4065, 61),
    (4066, 62),
    (4067, 63),
    (4068, 64),
    (4069, 65),
    (4070, 66),
    (4071, 67),
    (4072, 68),
    (4073, 69),
    (4075, 70),
    (4076, 71),
    (4077, 72),
    (4078, 73),
    (4079, 74),
    (4081, 75),
    (4083, 76),
    (4084, 77),
    (4086, 78),
    (4087, 79),
    (4088, 80),
    (4089, 81),
    (4090, 82),
    (4091, 83),
    (4092, 84),
    (4093, 85),
    (4094, 86),
    (4095, 87),
    (4096, 88),
    (4097, 89),
    (4098, 90),
    (4099, 91),
    (4101, 92),
    (4102, 93),
    (4103, 94),
    (4104, 95),
    (4106, 96),
    (4107, 97),
    (4108, 98),
    (4109, 99),
    (4110, 100),
    (4111, 101),
    (4112, 102),
    (4113, 103),
    (4114, 104),
    (4115, 105),
    (4118, 106),
    (4119, 107),
    (4120, 108),
    (4121, 109),
    (4123, 110),
    (4124, 111),
    (4126, 112),
    (4127, 113),
    (4128, 114),
    (4129, 115),
    (4130, 116),
    (4132, 117),
    (4133, 118),
    (4135, 119),
    (4136, 120),
    (4139, 121),
    (4140, 122),
    (4141, 123),
    (4142, 124),
    (4143, 125),
    (4144, 126),
    (4146, 127),
    (4147, 128),
    (4148, 129),
    (4149, 130),
    (4150, 131),
    (4151, 132),
    (4152, 133),
    (4153, 134),
    (4154, 135),
    (4155, 136),
    (4156, 137),
    (4157, 138),
    (4158, 139),
    (4159, 140),
    (4160, 141),
    (4161, 142),
    (4162, 143),
    (4163, 144),
    (4164, 145),
    (4165, 146),
    (4168, 147),
    (4170, 148),
    (4171, 149),
    (4172, 150),
    (4173, 151),
    (4176, 152),
    (4177, 153),
    (4181, 154),
    (4182, 155),
    (4183, 156),
    (4184, 157),
    (4185, 158),
    (4186, 159),
    (4187, 160),
    (4188, 161),
    (4190, 162),
    (4191, 163),
    (4192, 164),
    (4193, 165),
    (4194, 166),
    (4195, 167),
    (4196, 168),
    (4197, 169),
    (4198, 170),
    (4199, 171),
    (4200, 172),
    (4201, 173),
    (4202, 174),
    (4203, 175),
    (4204, 176),
    (4205, 177),
    (4207, 178),
    (4208, 179),
    (4209, 180),
    (4210, 181),
    (4211, 182),
    (4212, 183),
    (4213, 184),
    (4218, 185),
    (4219, 186),
    (4220, 187),
    (4221, 188),
    (4222, 189),
    (4224, 190),
    (4225, 191),
    (4228, 192),
    (4229, 193),
    (4230, 194),
    (4231, 195),
    (4232, 196),
    (4234, 197),
    (4235, 198),
    (4236, 199),
    (4237, 200),
    (4238, 201),
    (4239, 202),
    (4240, 203),
    (4241, 204),
    (4242, 205),
    (4243, 206),
    (4244, 207),
    (4245, 208),
    (4247, 209),
    (4251, 210),
    (4252, 211),
    (4253, 212),
    (4254, 213),
    (4257, 214),
    (4258, 215),
    (4259, 216),
    (4260, 217),
    (4263, 218),
    (4264, 219),
    (4265, 220),
    (4266, 221),
    (4267, 222),
    (4268, 223),
    (4269, 224),
    (4270, 225),
    (4271, 226),
    (4273, 227),
    (4274, 228),
    (4275, 229),
    (4276, 230),
    (4277, 231),
    (4278, 232),
    (4279, 233),
    (4280, 234),
    (4281, 235),
    (4282, 236),
    (4283, 237),
    (4284, 238),
    (4285, 239),
    (4286, 240),
    (4287, 241),
    (4288, 242),
    (4289, 243),
    (4290, 244),
    (4291, 245),
    (4292, 246),
    (4293, 247),
    (4294, 248),
    (4295, 249),
    (4296, 250),
    (4297, 251),
    (4299, 252),
    (4300, 253),
    (4301, 254),
    (4302, 255),
    (4303, 256),
    (4304, 257),
    (4305, 258),
    (4306, 259),
    (4307, 260),
    (4308, 261),
    (4309, 262),
    (4310, 263),
    (4311, 264),
    (4312, 265),
    (4314, 266),
    (4315, 267),
    (4316, 268),
    (4317, 269),
    (4318, 270),
    (4319, 271),
    (4320, 272),
    (4322, 273),
    (4323, 274),
    (4324, 275),
    (4330, 276),
    (4332, 277),
    (4333, 278),
    (4335, 279),
    (4337, 280),
    (4338, 281),
    (4339, 282),
    (4340, 283),
    (4341, 284),
    (4342, 285),
    (4345, 286),
    (4100, 287),
    (4191, 288),
    (4174, 289)
]
